<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warframe Status</title>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: #fff; padding: 20px; }
        .card { background: #2d2d2d; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #444; }
        h1 { color: #4dc9ff; margin-top: 0; }
        .ok { color: #5eff7e; font-weight: bold; }
        .error { color: #ff5e5e; font-weight: bold; }
        pre { background: #000; padding: 10px; color: #0f0; overflow: auto; max-height: 300px; font-size: 12px; }
    </style>
</head>
<body>

    <div class="card">
        <h1>üì° Estado de Warframe</h1>
        <div id="status">Cargando...</div>
    </div>

    <div class="card">
        <h3>üìÑ Datos Recibidos (JSON):</h3>
        <pre id="raw">Esperando...</pre>
    </div>

    <script>
        // --- AQU√ç EST√Å LA SOLUCI√ìN AL ERROR "NOT DEFINED" ---
        // He puesto tu URL directamente aqu√≠. No la borres.
        const PROXY_URL = 'https://warframe-proxy.adrtirram.workers.dev/';

        async function cargar() {
            const statusDiv = document.getElementById('status');
            const rawDiv = document.getElementById('raw');

            try {
                statusDiv.innerHTML = "Conectando al proxy...";
                
                // 1. Pedimos los datos
                const res = await fetch(PROXY_URL);
                
                // 2. Si falla la red o el servidor
                if (!res.ok) {
                    throw new Error(`Error ${res.status}: ${await res.text()}`);
                }

                const data = await res.json();

                // 3. Comprobamos si el JSON trae error dentro
                if (data.error) {
                    throw new Error(data.error);
                }

                // 4. √âXITO - Mostramos datos bonitos
                // (La API nueva usa 'timestamp', no 'Time')
                const fecha = new Date(data.timestamp).toLocaleString();
                const cetus = data.cetusCycle ? `Cetus: ${data.cetusCycle.shortString}` : "Cetus: --";

                statusDiv.innerHTML = `
                    <div class="ok">‚úÖ CONEXI√ìN CORRECTA</div>
                    <br>
                    <strong>Actualizado:</strong> ${fecha}<br>
                    <strong>Ciclo:</strong> ${cetus}<br>
                    <strong>Fisuras activas:</strong> ${data.fissures ? data.fissures.length : 0}
                `;

                // Mostramos el JSON crudo abajo
                rawDiv.textContent = JSON.stringify(data, null, 2);

            } catch (e) {
                console.error(e);
                statusDiv.innerHTML = `<div class="error">‚ùå ERROR: ${e.message}</div>`;
                rawDiv.textContent = "Revisa la consola (F12) para ver el error t√©cnico.";
            }
        }

        // Arrancar
        cargar();
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estado de Warframe (Proxy Propio)</title>
    <style>
        body { font-family: sans-serif; background: #222; color: #eee; padding: 20px; }
        .box { background: #333; padding: 15px; border-radius: 8px; margin-bottom: 10px; }
        pre { white-space: pre-wrap; word-wrap: break-word; font-size: 12px; color: #81f499;}
    </style>
</head>
<body>
    <h1>üì° Datos de Warframe en Vivo</h1>
    <p>Conectando a: <code>warframe-proxy.adrtirram.workers.dev</code></p>
    
    <div id="estado" class="box">Cargando datos...</div>

    <div class="box">
        <h3>Respuesta Raw (Primeros caracteres):</h3>
        <pre id="raw-preview">Esperando...</pre>
    </div>

    <script>
      async function cargarDatos() {
            const estadoDiv = document.getElementById('estado');
            const rawDiv = document.getElementById('raw-preview');
            
            try {
                estadoDiv.textContent = "Contactando sat√©lite...";
                
                const res = await fetch(PROXY_URL);
                const textoRaw = await res.text(); // Leemos como texto primero

                console.log("Respuesta recibida:", textoRaw.substring(0, 100)); // Ver en consola

                // Intentamos convertir ese texto a JSON
                let datos;
                try {
                    datos = JSON.parse(textoRaw);
                } catch (e) {
                    // Si falla aqu√≠, es que el texto no es JSON (es un error HTML o vac√≠o)
                    throw new Error(`No es JSON v√°lido. El servidor respondi√≥: "${textoRaw.substring(0,50)}..."`);
                }

                // SI LLEGAMOS AQU√ç, TODO FUE √âXITO
                const fecha = new Date(parseInt(datos.Time) * 1000).toLocaleString();
                estadoDiv.innerHTML = `
                    <div style="color: #4CAF50">‚úÖ <strong>Conexi√≥n Exitosa</strong></div>
                    <strong>Hora Servidor:</strong> ${fecha}<br>
                    <strong>Build:</strong> ${datos.BuildLabel}
                `;
                
                rawDiv.textContent = JSON.stringify(datos, null, 2).substring(0, 2000);

            } catch (err) {
                console.error(err);
                estadoDiv.innerHTML = `<div style="color: #ff5555">‚ùå Error: ${err.message}</div>`;
                // Si hay error, mostramos qu√© nos lleg√≥ realmente en la caja de abajo
                rawDiv.textContent = "Error de lectura.";
            }
        }
    </script>
</body>
</html>
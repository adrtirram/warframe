<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estado de Warframe (Proxy Propio)</title>
    <style>
        body { font-family: sans-serif; background: #222; color: #eee; padding: 20px; }
        .box { background: #333; padding: 15px; border-radius: 8px; margin-bottom: 10px; }
        pre { white-space: pre-wrap; word-wrap: break-word; font-size: 12px; color: #81f499;}
    </style>
</head>
<body>
    <h1>üì° Datos de Warframe en Vivo</h1>
    <p>Conectando a: <code>warframe-proxy.adrtirram.workers.dev</code></p>
    
    <div id="estado" class="box">Cargando datos...</div>

    <div class="box">
        <h3>Respuesta Raw (Primeros caracteres):</h3>
        <pre id="raw-preview">Esperando...</pre>
    </div>
</body>
    <script>
        const PROXY_URL = 'https://warframe-proxy.adrtirram.workers.dev/';

        async function cargarDatos() {
            const estadoDiv = document.getElementById('estado');
            const rawDiv = document.getElementById('raw-preview');
            
            try {
                estadoDiv.textContent = "Conectando...";
                
                const res = await fetch(PROXY_URL);
                
                // Si la respuesta no es OK (es 404 o 500), leemos el mensaje de error del cuerpo
                if (!res.ok) {
                    const errorTexto = await res.text();
                    throw new Error(`Fallo en el servidor (${res.status}): ${errorTexto}`);
                }
                
                // Si llegamos aqu√≠, es que todo fue bien
                const datos = await res.json();

                // Verificar si Warframe devolvi√≥ error interno
                if (datos.error) {
                     throw new Error(`El Proxy reporta: ${datos.error}`);
                }

                // MOSTRAR DATOS
                const fecha = new Date(parseInt(datos.Time) * 1000).toLocaleString();
                estadoDiv.innerHTML = `
                    <div style="color: #4CAF50; font-size: 1.2em;">‚úÖ CONEXI√ìN ESTABLECIDA</div>
                    <br>
                    <strong>Fecha Servidor:</strong> ${fecha}<br>
                    <strong>Versi√≥n:</strong> ${datos.BuildLabel}<br>
                    <strong>Eventos activos:</strong> ${datos.Events ? datos.Events.length : 0}
                `;
                
                rawDiv.textContent = JSON.stringify(datos, null, 2).substring(0, 3000);
                console.log("Datos recibidos correctamente:", datos);

            } catch (err) {
                console.error("Error detallado:", err);
                estadoDiv.innerHTML = `<div style="color: #ff5555; font-weight: bold;">‚ùå ERROR CR√çTICO</div><p>${err.message}</p>`;
                rawDiv.textContent = "Revisa la consola (F12) para m√°s detalles.";
            }
        }

        cargarDatos();
    </script>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cephalon Siaro ‚Äî Panel Warframe</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --azul:    #00d4ff;
      --azul2:   #0077bb;
      --dorado:  #c8a84b;
      --rojo:    #ff4444;
      --verde:   #00ff88;
      --naranja: #ff8800;
      --morado:  #aa44ff;
      --fondo:   #02060e;
      --fondo2:  #050d18;
      --panel:   #07111f;
      --panel2:  #091524;
      --borde:   #0d2236;
      --borde2:  #122840;
      --texto:   #8ab8d4;
      --texto2:  #5588a0;
      --blanco:  #d8eeff;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--fondo); color: var(--texto);
      font-family: 'Rajdhani', sans-serif; font-size: 15px;
      min-height: 100vh; overflow-x: hidden;
    }
    body::before {
      content: ''; position: fixed; inset: 0;
      background:
        radial-gradient(ellipse 60% 40% at 10% 0%, rgba(0,180,255,.07) 0%, transparent 70%),
        radial-gradient(ellipse 50% 50% at 90% 100%, rgba(0,80,180,.09) 0%, transparent 70%),
        repeating-linear-gradient(0deg, transparent, transparent 39px, rgba(0,150,255,.02) 40px),
        repeating-linear-gradient(90deg, transparent, transparent 39px, rgba(0,150,255,.02) 40px);
      pointer-events: none; z-index: 0;
    }
    header {
      position: sticky; top: 0; z-index: 200;
      background: rgba(5,13,24,.97); border-bottom: 1px solid var(--borde2);
      backdrop-filter: blur(12px); padding: 0 24px;
      display: flex; align-items: center; justify-content: space-between;
      height: 60px; box-shadow: 0 2px 40px rgba(0,0,0,.6);
    }
    .logo { display: flex; align-items: center; gap: 12px; }
    .logo svg { width: 36px; height: 36px; }
    .logo-text { font-family: 'Orbitron', sans-serif; font-weight: 900; font-size: 1rem; color: var(--azul); letter-spacing: .12em; text-shadow: 0 0 20px rgba(0,212,255,.5); }
    .logo-sub { font-size: .65rem; color: var(--texto2); letter-spacing: .2em; display: block; }
    .header-right { display: flex; align-items: center; gap: 12px; }
    .plat-btns { display: flex; gap: 4px; }
    .btn-plat {
      background: transparent; border: 1px solid var(--borde2); color: var(--texto2);
      font-family: 'Rajdhani', sans-serif; font-size: .78rem; font-weight: 700; letter-spacing: .1em;
      padding: 4px 12px; cursor: pointer; transition: all .2s;
      clip-path: polygon(6px 0%, 100% 0%, calc(100% - 6px) 100%, 0% 100%);
    }
    .btn-plat.activo, .btn-plat:hover { background: rgba(0,119,187,.3); border-color: var(--azul); color: var(--azul); }
    .btn-reload {
      background: linear-gradient(135deg, var(--azul2), #003366); border: 1px solid var(--azul); color: var(--azul);
      font-family: 'Orbitron', sans-serif; font-size: .6rem; font-weight: 700; letter-spacing: .15em;
      padding: 7px 18px; cursor: pointer; transition: all .2s; display: flex; align-items: center; gap: 6px;
      clip-path: polygon(8px 0%, 100% 0%, calc(100% - 8px) 100%, 0% 100%);
    }
    .btn-reload:hover { background: var(--azul); color: #fff; box-shadow: 0 0 16px rgba(0,180,255,.4); }
    .btn-reload.spin svg { animation: girar .7s linear infinite; }
    @keyframes girar { to { transform: rotate(360deg); } }

    #banner {
      display: none; position: sticky; top: 60px; z-index: 190;
      padding: 7px 24px; font-size: .82rem; font-weight: 700; letter-spacing: .08em; text-align: center;
    }
    #banner.ok    { background: rgba(0,255,136,.1); color: var(--verde); border-bottom: 1px solid rgba(0,255,136,.25); display:block; }
    #banner.error { background: rgba(255,68,68,.1); color: var(--rojo); border-bottom: 1px solid rgba(255,68,68,.25); display:block; }
    #banner.aviso { background: rgba(255,136,0,.1); color: var(--naranja); border-bottom: 1px solid rgba(255,136,0,.25); display:block; }

    nav {
      background: var(--fondo2); border-bottom: 1px solid var(--borde);
      display: flex; overflow-x: auto; scrollbar-width: none;
      position: sticky; top: 60px; z-index: 150;
    }
    nav::-webkit-scrollbar { display: none; }
    .nav-tab {
      background: transparent; border: none; border-bottom: 2px solid transparent;
      color: var(--texto2); font-family: 'Rajdhani', sans-serif; font-size: .88rem; font-weight: 600;
      letter-spacing: .07em; padding: 13px 18px; cursor: pointer; white-space: nowrap;
      transition: all .2s; display: flex; align-items: center; gap: 6px;
    }
    .nav-tab:hover { color: var(--texto); background: rgba(0,150,255,.05); }
    .nav-tab.activo { color: var(--azul); border-bottom-color: var(--azul); background: rgba(0,180,255,.07); }
    .badge { background: var(--rojo); color: #fff; font-size: .62rem; font-weight: 700; padding: 1px 5px; border-radius: 8px; min-width: 17px; text-align: center; }

    main { position: relative; z-index: 1; padding: 22px 24px 40px; max-width: 1400px; margin: 0 auto; }
    .seccion { display: none; }
    .seccion.activa { display: block; }
    .info-ts { color: var(--texto2); font-size: .78rem; margin-bottom: 18px; }
    .info-ts span { color: var(--azul); }

    .cargando { display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 14px; padding: 60px 0; }
    .spinner { width: 44px; height: 44px; border: 2px solid var(--borde2); border-top-color: var(--azul); border-radius: 50%; animation: girar .8s linear infinite; }
    .cargando p { color: var(--texto2); font-weight: 600; letter-spacing: .1em; font-size: .85rem; }

    .bloque-error { background: rgba(255,68,68,.07); border: 1px solid rgba(255,68,68,.25); padding: 20px 24px; }
    .bloque-error h3 { color: var(--rojo); font-family: 'Orbitron',sans-serif; font-size: .78rem; letter-spacing: .15em; margin-bottom: 10px; }
    .bloque-error p { color: #ff9999; font-size: .88rem; line-height: 1.6; margin-bottom: 6px; }
    .bloque-error code { background: rgba(255,68,68,.15); padding: 2px 6px; color: #ffaaaa; font-size: .8rem; }
    .btn-retry { margin-top: 12px; background: rgba(255,68,68,.15); border: 1px solid rgba(255,68,68,.4); color: var(--rojo); font-family: 'Orbitron',sans-serif; font-size: .65rem; font-weight: 700; letter-spacing: .15em; padding: 8px 20px; cursor: pointer; transition: all .2s; }
    .btn-retry:hover { background: rgba(255,68,68,.25); }

    .sec-header { display: flex; align-items: center; gap: 14px; margin-bottom: 18px; }
    .sec-header h2 { font-family: 'Orbitron',sans-serif; font-size: .95rem; font-weight: 700; color: var(--blanco); letter-spacing: .15em; }
    .sec-header .sep { flex: 1; height: 1px; background: linear-gradient(90deg, var(--borde2), transparent); }

    .grid { display: grid; gap: 14px; }
    .g2 { grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); }
    .g3 { grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); }

    .tarjeta { background: var(--panel); border: 1px solid var(--borde); padding: 16px 18px; position: relative; overflow: hidden; transition: border-color .2s, box-shadow .2s; animation: fadeUp .3s ease both; }
    .tarjeta::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, var(--azul2), transparent); opacity: 0; transition: opacity .2s; }
    .tarjeta:hover { border-color: var(--borde2); box-shadow: 0 4px 28px rgba(0,0,0,.4); }
    .tarjeta:hover::before { opacity: 1; }
    @keyframes fadeUp { from { opacity:0; transform:translateY(12px); } to { opacity:1; transform:none; } }

    .ttitulo { font-family: 'Orbitron',sans-serif; font-size: .68rem; font-weight: 700; color: var(--azul); letter-spacing: .18em; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
    .ttitulo .lin { flex:1; height:1px; background: linear-gradient(90deg, var(--borde2), transparent); }

    .fila { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,.04); gap: 10px; }
    .fila:last-child { border-bottom: none; }
    .fk { color: var(--texto2); font-size: .83rem; flex-shrink: 0; }
    .fv { color: var(--blanco); font-weight: 600; text-align: right; }
    .fv.az { color: var(--azul); } .fv.vd { color: var(--verde); } .fv.do { color: var(--dorado); } .fv.rj { color: var(--rojo); } .fv.mo { color: var(--morado); }

    .etiq { display: inline-block; padding: 2px 9px; font-size: .68rem; font-weight: 700; letter-spacing: .1em; clip-path: polygon(5px 0%,100% 0%,calc(100% - 5px) 100%,0% 100%); }
    .et-ok { background:rgba(0,255,136,.12); color:var(--verde); border:1px solid rgba(0,255,136,.28); }
    .et-no { background:rgba(255,68,68,.12); color:var(--rojo); border:1px solid rgba(255,68,68,.28); }
    .et-az { background:rgba(0,212,255,.1); color:var(--azul); border:1px solid rgba(0,212,255,.28); }
    .et-do { background:rgba(200,168,75,.12); color:var(--dorado); border:1px solid rgba(200,168,75,.28); }

    .barra-w { background:var(--borde); height:5px; border-radius:3px; overflow:hidden; margin:7px 0; }
    .barra { height:100%; border-radius:3px; transition:width .5s; }
    .b-az { background: linear-gradient(90deg, var(--azul2), var(--azul)); }
    .b-vd { background: linear-gradient(90deg, #008844, var(--verde)); }
    .b-do { background: linear-gradient(90deg, #886622, var(--dorado)); }

    .contador { font-family:'Orbitron',sans-serif; font-size:1.05rem; font-weight:700; color:var(--blanco); }
    .cnt-urgente { color:var(--rojo); animation:parpadeo 1s ease infinite; }
    .cnt-aviso { color:var(--naranja); }
    @keyframes parpadeo { 50%{opacity:.5;} }

    .chip { display:inline-flex; align-items:center; background:rgba(0,150,255,.1); border:1px solid var(--borde2); padding:2px 9px; font-size:.78rem; font-weight:600; color:var(--texto); margin:2px; }

    .ciclo-wrap { display:flex; align-items:center; gap:10px; margin:8px 0; }
    .ciclo-ico { font-size:1.3rem; }
    .ciclo-nombre { font-family:'Orbitron',sans-serif; font-size:.82rem; font-weight:700; }
    .c-dia { color:#ffdd88; } .c-noche { color:#8899ff; } .c-calido { color:#ff8844; } .c-frio { color:#88ccff; }

    .estado-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(148px,1fr)); gap:10px; margin-bottom:20px; }
    .ec { background:var(--panel2); border:1px solid var(--borde); padding:13px 14px; text-align:center; animation:fadeUp .3s ease both; }
    .ec-lab { font-size:.68rem; font-weight:700; letter-spacing:.14em; color:var(--texto2); margin-bottom:7px; text-transform:uppercase; }
    .ec-val { font-family:'Orbitron',sans-serif; font-size:.92rem; font-weight:700; color:var(--blanco); }

    .tbl-wrap { overflow-x:auto; }
    table { width:100%; border-collapse:collapse; font-size:.86rem; }
    thead tr { border-bottom:2px solid var(--borde2); }
    th { font-family:'Orbitron',sans-serif; font-size:.62rem; letter-spacing:.14em; color:var(--texto2); padding:9px 11px; text-align:left; white-space:nowrap; }
    tbody tr { border-bottom:1px solid rgba(255,255,255,.04); transition:background .15s; }
    tbody tr:hover { background:rgba(0,150,255,.05); }
    td { padding:9px 11px; color:var(--texto); }
    td.b { color:var(--blanco); font-weight:600; }

    .busqueda { display:flex; gap:8px; margin-bottom:18px; }
    .inp { flex:1; background:var(--panel2); border:1px solid var(--borde2); color:var(--blanco); font-family:'Rajdhani',sans-serif; font-size:.92rem; padding:9px 14px; outline:none; transition:border-color .2s; }
    .inp:focus { border-color:var(--azul); box-shadow:0 0 10px rgba(0,180,255,.18); }
    .inp::placeholder { color:var(--texto2); }
    .btn-buscar { background:var(--azul2); border:1px solid var(--azul); color:var(--azul); font-family:'Orbitron',sans-serif; font-size:.65rem; font-weight:700; letter-spacing:.14em; padding:9px 22px; cursor:pointer; transition:all .2s; }
    .btn-buscar:hover { background:var(--azul); color:#fff; box-shadow:0 0 14px rgba(0,180,255,.35); }

    .no-data { text-align:center; padding:36px; color:var(--texto2); font-style:italic; }
    ::-webkit-scrollbar { width:5px; height:5px; }
    ::-webkit-scrollbar-track { background:var(--fondo2); }
    ::-webkit-scrollbar-thumb { background:var(--borde2); border-radius:3px; }
    ::-webkit-scrollbar-thumb:hover { background:var(--azul2); }
    @media(max-width:580px){ header{padding:0 12px;} main{padding:14px 12px 30px;} .logo-text{font-size:.85rem;} .nav-tab{padding:11px 13px;} }
  </style>
</head>
<body>

<header>
  <div class="logo">
    <svg viewBox="0 0 40 40" fill="none">
      <polygon points="20,2 38,30 2,30" fill="none" stroke="#00d4ff" stroke-width="1.5" opacity=".6"/>
      <polygon points="20,8 33,28 7,28" fill="none" stroke="#0077bb" stroke-width="1" opacity=".4"/>
      <circle cx="20" cy="20" r="5" fill="#00d4ff" opacity=".9"/>
      <circle cx="20" cy="20" r="8" fill="none" stroke="#00d4ff" stroke-width=".8" opacity=".4"/>
    </svg>
    <div>
      <span class="logo-text">CEPHALON SIARO</span>
      <span class="logo-sub">PANEL DE ESTADO WARFRAME</span>
    </div>
  </div>
  <div class="header-right">
    <div class="plat-btns">
      <button class="btn-plat activo" onclick="cambiarPlat('pc',this)">PC</button>
      <button class="btn-plat" onclick="cambiarPlat('ps4',this)">PS</button>
      <button class="btn-plat" onclick="cambiarPlat('xb1',this)">XBOX</button>
      <button class="btn-plat" onclick="cambiarPlat('swi',this)">NSW</button>
    </div>
    <button class="btn-reload" id="btnReload" onclick="recargar()">
      <svg id="icoReload" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/>
        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
      </svg>
      ACTUALIZAR
    </button>
  </div>
</header>

<div id="banner"></div>

<nav>
  <button class="nav-tab activo" onclick="irA('estado',this)">üåç Estado</button>
  <button class="nav-tab" onclick="irA('alertas',this)">üö® Alertas <span class="badge" id="badge-alertas">‚Äî</span></button>
  <button class="nav-tab" onclick="irA('invasiones',this)">‚öîÔ∏è Invasiones</button>
  <button class="nav-tab" onclick="irA('fisuras',this)">üîÆ Fisuras</button>
  <button class="nav-tab" onclick="irA('syndicatos',this)">üèõÔ∏è Syndicatos</button>
  <button class="nav-tab" onclick="irA('baro',this)">‚ú¶ Baro Ki'Teer</button>
  <button class="nav-tab" onclick="irA('arbitraje',this)">‚ö° Arbitraje</button>
  <button class="nav-tab" onclick="irA('ciclos',this)">üèïÔ∏è Ciclos</button>
  <button class="nav-tab" onclick="irA('construccion',this)">üî® Construcci√≥n</button>
  <button class="nav-tab" onclick="irA('mejoras',this)">üì° Mejoras</button>
  <button class="nav-tab" onclick="irA('noticias',this)">üì∞ Noticias</button>
  <button class="nav-tab" onclick="irA('eventos',this)">üéØ Eventos</button>
  <button class="nav-tab" onclick="irA('items',this)">üîç √çtems</button>
  <button class="nav-tab" onclick="irA('rivenes',this)">üí† Rivens</button>
</nav>

<main>
  <div class="info-ts" id="info-ts">Iniciando...</div>

  <section class="seccion activa" id="sec-estado"><div id="c-estado"><div class="cargando"><div class="spinner"></div><p>CONECTANDO CON LA API...</p></div></div></section>
  <section class="seccion" id="sec-alertas"><div class="sec-header"><h2>ALERTAS ACTIVAS</h2><div class="sep"></div></div><div id="c-alertas"><div class="cargando"><div class="spinner"></div><p>CARGANDO...</p></div></div></section>
  <section class="seccion" id="sec-invasiones"><div class="sec-header"><h2>INVASIONES EN CURSO</h2><div class="sep"></div></div><div id="c-invasiones"><div class="cargando"><div class="spinner"></div><p>CARGANDO...</p></div></div></section>
  <section class="seccion" id="sec-fisuras"><div class="sec-header"><h2>FISURAS DEL VAC√çO</h2><div class="sep"></div></div><div id="c-fisuras"><div class="cargando"><div class="spinner"></div><p>CARGANDO...</p></div></div></section>
  <section class="seccion" id="sec-syndicatos"><div class="sec-header"><h2>MISIONES DE SYNDICATO</h2><div class="sep"></div></div><div id="c-syndicatos"><div class="cargando"><div class="spinner"></div><p>CARGANDO...</p></div></div></section>
  <section class="seccion" id="sec-baro"><div class="sec-header"><h2>BARO KI'TEER</h2><div class="sep"></div></div><div id="c-baro"><div class="cargando"><div class="spinner"></div><p>CARGANDO...</p></div></div></section>
  <section class="seccion" id="sec-arbitraje"><div class="sec-header"><h2>ARBITRAJE</h2><div class="sep"></div></div><div id="c-arbitraje"><div class="cargando"><div class="spinner"></div><p>CARGANDO...</p></div></div></section>
  <section class="seccion" id="sec-ciclos"><div class="sec-header"><h2>CICLOS DE MUNDO ABIERTO</h2><div class="sep"></div></div><div id="c-ciclos"><div class="cargando"><div class="spinner"></div><p>CARGANDO...</p></div></div></section>
  <section class="seccion" id="sec-construccion"><div class="sec-header"><h2>PROGRESO DE CONSTRUCCI√ìN</h2><div class="sep"></div></div><div id="c-construccion"><div class="cargando"><div class="spinner"></div><p>CARGANDO...</p></div></div></section>
  <section class="seccion" id="sec-mejoras"><div class="sec-header"><h2>MEJORAS GLOBALES</h2><div class="sep"></div></div><div id="c-mejoras"><div class="cargando"><div class="spinner"></div><p>CARGANDO...</p></div></div></section>
  <section class="seccion" id="sec-noticias"><div class="sec-header"><h2>NOTICIAS</h2><div class="sep"></div></div><div id="c-noticias"><div class="cargando"><div class="spinner"></div><p>CARGANDO...</p></div></div></section>
  <section class="seccion" id="sec-eventos"><div class="sec-header"><h2>EVENTOS EN CURSO</h2><div class="sep"></div></div><div id="c-eventos"><div class="cargando"><div class="spinner"></div><p>CARGANDO...</p></div></div></section>
  <section class="seccion" id="sec-items">
    <div class="sec-header"><h2>B√öSQUEDA DE √çTEMS</h2><div class="sep"></div></div>
    <div class="busqueda">
      <input class="inp" id="inp-item" type="text" placeholder="Ej: Ash Prime, Boltor, Rhino..." onkeydown="if(event.key==='Enter')buscarItem()"/>
      <button class="btn-buscar" onclick="buscarItem()">BUSCAR</button>
    </div>
    <div id="c-items"><p class="no-data">Escribe el nombre de un √≠tem para buscarlo.</p></div>
  </section>
  <section class="seccion" id="sec-rivenes">
    <div class="sec-header"><h2>ESTAD√çSTICAS DE RIVENS</h2><div class="sep"></div></div>
    <div class="busqueda">
      <input class="inp" id="inp-riven" type="text" placeholder="Ej: Tigris, Soma, Rubico..." onkeydown="if(event.key==='Enter')buscarRiven()"/>
      <button class="btn-buscar" onclick="buscarRiven()">BUSCAR</button>
    </div>
    <div id="c-rivenes"><p class="no-data">Escribe el nombre de un arma para ver estad√≠sticas de riven.</p></div>
  </section>
</main>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIGURACI√ìN ‚Äî 3 estrategias de conexi√≥n
// La primera que funcione se usa para todo
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const PROXIES = [
  raw => raw,                                                        // Directo
  raw => `https://corsproxy.io/?${encodeURIComponent(raw)}`,         // Proxy 1
  raw => `https://api.allorigins.win/raw?url=${encodeURIComponent(raw)}`, // Proxy 2
];
let proxyIdx = 0;
let plat = 'pc';
let cache = {};

async function apiFetch(endpoint) {
  const raw = `https://api.warframestat.us${endpoint}${endpoint.includes('?')?'&':'?'}language=es`;
  let ultimoError = '';

  for (let i = 0; i < PROXIES.length; i++) {
    const url = PROXIES[i](raw);
    try {
      const ctrl = new AbortController();
      const timeout = setTimeout(() => ctrl.abort(), 10000);
      const res = await fetch(url, { signal: ctrl.signal });
      clearTimeout(timeout);
      if (!res.ok) { ultimoError = `HTTP ${res.status}`; continue; }
      const data = await res.json();
      // Si cambiamos de proxy, notificar
      if (i !== proxyIdx) {
        proxyIdx = i;
        const nombres = ['directo', 'corsproxy.io', 'allorigins.win'];
        setBanner(i === 0 ? 'ok' : 'aviso',
          i === 0
            ? '‚úî Conexi√≥n directa con api.warframestat.us establecida'
            : `‚úî Conectado mediante proxy (${nombres[i]}) ‚Äî Datos en tiempo real`
        );
      }
      return data;
    } catch(e) {
      ultimoError = e.name === 'AbortError' ? 'Timeout (10s)' : e.message;
    }
  }
  throw new Error(ultimoError || 'Sin conexi√≥n');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILIDADES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setBanner(tipo, msg) {
  const b = document.getElementById('banner');
  b.className = tipo; b.textContent = msg;
  if (tipo === 'ok') setTimeout(() => { b.className = ''; }, 5000);
}

function tr(iso) {
  const diff = new Date(iso) - Date.now();
  if (diff <= 0) return { txt:'EXPIRADO', cls:'contador cnt-urgente' };
  const h = Math.floor(diff/3600000), m = Math.floor((diff%3600000)/60000), s = Math.floor((diff%60000)/1000);
  const txt = h > 0 ? `${h}h ${String(m).padStart(2,'0')}m` : `${m}m ${String(s).padStart(2,'0')}s`;
  const cls = diff<1800000 ? 'contador cnt-urgente' : diff<3600000 ? 'contador cnt-aviso' : 'contador';
  return { txt, cls };
}
function ctr(iso) { const t = tr(iso); return `<span class="${t.cls}">${t.txt}</span>`; }
function etOk(v) { return v ? '<span class="etiq et-ok">ACTIVO</span>' : '<span class="etiq et-no">INACTIVO</span>'; }
function chips(arr) { return arr?.length ? arr.map(r=>`<span class="chip">${r}</span>`).join('') : '<span style="color:var(--texto2)">‚Äî</span>'; }
function ff(iso) { return iso ? new Date(iso).toLocaleString('es-ES',{day:'2-digit',month:'short',hour:'2-digit',minute:'2-digit'}) : '‚Äî'; }
function c(id) { return document.getElementById(`c-${id}`); }
function spin() { return '<div class="cargando"><div class="spinner"></div><p>CARGANDO DATOS...</p></div>'; }
function errHTML(id, msg) {
  return `<div class="bloque-error">
    <h3>‚ö† ERROR DE CONEXI√ìN</h3>
    <p>Se probaron 3 m√©todos de conexi√≥n diferentes y todos fallaron.</p>
    <p>Error: <code>${msg}</code></p>
    <p>Verifica que tienes conexi√≥n a internet. La API de Warframe es p√∫blica y gratuita.</p>
    <button class="btn-retry" onclick="cargar('${id}',true)">‚Ü∫ REINTENTAR</button>
  </div>`;
}
function anim(cont) {
  [...cont.querySelectorAll('.tarjeta,.ec')].forEach((el,i)=>{ el.style.animationDelay=`${i*.04}s`; });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVEGACI√ìN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function irA(id, btn) {
  document.querySelectorAll('.seccion').forEach(s=>s.classList.remove('activa'));
  document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('activo'));
  document.getElementById(`sec-${id}`).classList.add('activa');
  btn.classList.add('activo');
  if (!['items','rivenes'].includes(id)) cargar(id);
}
function cambiarPlat(p, btn) {
  plat=p; cache={};
  document.querySelectorAll('.btn-plat').forEach(b=>b.classList.remove('activo')); btn.classList.add('activo');
  const id = document.querySelector('.seccion.activa').id.replace('sec-','');
  if (!['items','rivenes'].includes(id)) cargar(id,true);
}
function recargar() {
  const btn=document.getElementById('btnReload'); btn.classList.add('spin'); cache={};
  const id = document.querySelector('.seccion.activa').id.replace('sec-','');
  if (!['items','rivenes'].includes(id)) cargar(id,true);
  setTimeout(()=>btn.classList.remove('spin'),1200);
  upTS();
}
function upTS() {
  document.getElementById('info-ts').innerHTML =
    `Actualizado: <span>${new Date().toLocaleString('es-ES')}</span> ¬∑ Plataforma: <span>${plat.toUpperCase()}</span>`;
}

async function cargar(id, forzar=false) {
  if (!forzar && cache[id]) { render(id, cache[id]); return; }
  if (id==='estado')  { return cargarEstado(forzar); }
  if (id==='ciclos')  { return cargarCiclos(forzar); }
  const eps = {
    alertas:`/${plat}/alerts`, invasiones:`/${plat}/invasions`,
    fisuras:`/${plat}/fissures`, syndicatos:`/${plat}/syndicateMissions`,
    baro:`/${plat}/voidTrader`, arbitraje:`/${plat}/arbitration`,
    construccion:`/${plat}/constructionProgress`, mejoras:`/${plat}/globalUpgrades`,
    noticias:`/${plat}/news`, eventos:`/${plat}/events`,
  };
  if (!eps[id]) return;
  c(id).innerHTML = spin();
  try { const d=await apiFetch(eps[id]); cache[id]=d; render(id,d); }
  catch(e) { c(id).innerHTML = errHTML(id,e.message); }
}

function render(id, data) {
  const fns = { alertas:renderAlertas, invasiones:renderInvasiones, fisuras:renderFisuras,
    syndicatos:renderSyndicatos, baro:renderBaro, arbitraje:renderArbitraje,
    construccion:renderConstruccion, mejoras:renderMejoras, noticias:renderNoticias, eventos:renderEventos };
  if (fns[id]) fns[id](data);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ESTADO MUNDIAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function cargarEstado(forzar=false) {
  if (!forzar && cache.estado) { renderEstado(cache.estado); return; }
  c('estado').innerHTML = spin();
  try {
    const [alertas,invasiones,fisuras,baro,cetus] = await Promise.all([
      apiFetch(`/${plat}/alerts`), apiFetch(`/${plat}/invasions`),
      apiFetch(`/${plat}/fissures`), apiFetch(`/${plat}/voidTrader`),
      apiFetch(`/${plat}/cetusCycle`),
    ]);
    cache.estado={alertas,invasiones,fisuras,baro,cetus};
    renderEstado(cache.estado);
    upTS();
  } catch(e) { c('estado').innerHTML = errHTML('estado',e.message); }
}

function renderEstado(d) {
  const cont=c('estado');
  const aN=(d.alertas||[]).length, iN=(d.invasiones||[]).filter(i=>!i.completed).length, fN=(d.fisuras||[]).filter(f=>f.active).length;
  document.getElementById('badge-alertas').textContent=aN;
  cont.innerHTML=`
    <div class="sec-header"><h2>ESTADO DEL SISTEMA SOLAR</h2><div class="sep"></div></div>
    <div class="estado-grid">
      <div class="ec"><div class="ec-lab">üö® Alertas</div><div class="ec-val" style="color:${aN?'var(--rojo)':'var(--verde)'}">${aN}</div></div>
      <div class="ec"><div class="ec-lab">‚öî Invasiones</div><div class="ec-val" style="color:${iN?'var(--naranja)':'var(--verde)'}">${iN}</div></div>
      <div class="ec"><div class="ec-lab">üîÆ Fisuras</div><div class="ec-val" style="color:var(--azul)">${fN}</div></div>
      <div class="ec"><div class="ec-lab">‚ú¶ Baro</div><div class="ec-val" style="color:${d.baro.active?'var(--verde)':'var(--dorado)'}">${d.baro.active?'PRESENTE':'AUSENTE'}</div></div>
      <div class="ec"><div class="ec-lab">üåÖ Cetus</div><div class="ec-val" style="color:${d.cetus.isDay?'#ffdd88':'#8899ff'}">${d.cetus.isDay?'‚òÄ D√çA':'üåô NOCHE'}</div></div>
    </div>
    <div class="grid g2">
      <div class="tarjeta">
        <div class="ttitulo">BARO KI'TEER <div class="lin"></div></div>
        <div class="fila"><span class="fk">Estado</span><span class="fv">${etOk(d.baro.active)}</span></div>
        <div class="fila"><span class="fk">Ubicaci√≥n</span><span class="fv az">${d.baro.location||'‚Äî'}</span></div>
        <div class="fila"><span class="fk">${d.baro.active?'Desaparece en':'Llega en'}</span>${ctr(d.baro.active?d.baro.expiry:d.baro.activation)}</div>
        ${d.baro.active&&d.baro.inventory?.length
          ?`<div style="margin-top:10px"><div class="fk" style="margin-bottom:5px">Inventario (${d.baro.inventory.length} √≠tems):</div>
            <div style="max-height:120px;overflow-y:auto">${d.baro.inventory.map(i=>`<div class="fila"><span class="fk">${i.item}</span><span class="fv do">${i.ducats}üü° ${(i.credits||0).toLocaleString()}‚ú¶</span></div>`).join('')}</div></div>`:''}
      </div>
      <div class="tarjeta">
        <div class="ttitulo">CETUS ‚Äî EIDOLON <div class="lin"></div></div>
        <div class="ciclo-wrap"><span class="ciclo-ico">${d.cetus.isDay?'‚òÄÔ∏è':'üåô'}</span><span class="ciclo-nombre ${d.cetus.isDay?'c-dia':'c-noche'}">${d.cetus.isDay?'FASE DIURNA':'FASE NOCTURNA'}</span></div>
        <div class="fila"><span class="fk">Tiempo restante</span>${ctr(d.cetus.expiry)}</div>
      </div>
      ${aN?`<div class="tarjeta">
        <div class="ttitulo">√öLTIMA ALERTA <div class="lin"></div></div>
        <div class="fila"><span class="fk">Misi√≥n</span><span class="fv">${d.alertas[0]?.mission?.type||'‚Äî'}</span></div>
        <div class="fila"><span class="fk">Nodo</span><span class="fv az">${d.alertas[0]?.mission?.node||'‚Äî'}</span></div>
        <div class="fila"><span class="fk">Expira en</span>${ctr(d.alertas[0]?.expiry)}</div>
      </div>`:''}
    </div>`;
  anim(cont);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderAlertas(data) {
  const cont=c('alertas'); document.getElementById('badge-alertas').textContent=data.length;
  if (!data.length){cont.innerHTML='<p class="no-data">No hay alertas activas.</p>';return;}
  cont.innerHTML=`<div class="grid g2">${data.map(a=>{const m=a.mission||{};return`<div class="tarjeta">
    <div class="ttitulo">${m.type||'ALERTA'} <div class="lin"></div></div>
    <div class="fila"><span class="fk">Nodo</span><span class="fv az">${m.node||'‚Äî'}</span></div>
    <div class="fila"><span class="fk">Facci√≥n</span><span class="fv">${m.faction||'‚Äî'}</span></div>
    <div class="fila"><span class="fk">Nivel</span><span class="fv">${m.minEnemyLevel||'?'}‚Äì${m.maxEnemyLevel||'?'}</span></div>
    <div class="fila"><span class="fk">Expira en</span>${ctr(a.expiry)}</div>
    <div style="margin-top:8px">${chips(a.rewardTypes)}</div>
  </div>`;}).join('')}</div>`;
  anim(cont);
}

function renderInvasiones(data) {
  const cont=c('invasiones'); const act=data.filter(i=>!i.completed);
  if(!act.length){cont.innerHTML='<p class="no-data">No hay invasiones activas.</p>';return;}
  cont.innerHTML=`<div class="grid g2">${act.map(i=>{const p=parseFloat(i.completion||0).toFixed(1);return`<div class="tarjeta">
    <div class="ttitulo">${i.node||'Invasi√≥n'} <div class="lin"></div></div>
    <div class="fila"><span class="fk">Atacante</span><span class="fv rj">${i.attackingFaction||'‚Äî'}</span></div>
    <div class="fila"><span class="fk">Defensor</span><span class="fv az">${i.defendingFaction||'‚Äî'}</span></div>
    <div class="fila"><span class="fk">Progreso</span><span class="fv">${p}%</span></div>
    <div class="barra-w"><div class="barra b-az" style="width:${Math.min(Math.abs(p),100)}%"></div></div>
    ${i.attackerReward?.itemString?`<div class="fila"><span class="fk">Rew. Atacante</span><span class="fv do">${i.attackerReward.itemString}</span></div>`:''}
    ${i.defenderReward?.itemString?`<div class="fila"><span class="fk">Rew. Defensor</span><span class="fv do">${i.defenderReward.itemString}</span></div>`:''}
  </div>`;}).join('')}</div>`;
  anim(cont);
}

function renderFisuras(data) {
  const cont=c('fisuras'); const act=(data||[]).filter(f=>f.active).sort((a,b)=>a.tierNum-b.tierNum);
  if(!act.length){cont.innerHTML='<p class="no-data">No hay fisuras activas.</p>';return;}
  const col={Lith:'var(--verde)',Meso:'var(--azul)',Neo:'var(--naranja)',Axi:'var(--dorado)',Requiem:'var(--morado)'};
  cont.innerHTML=`<div class="grid g3">${act.map(f=>{const cc=col[f.tier]||'var(--texto)';return`<div class="tarjeta">
    <div class="ttitulo" style="color:${cc}">${f.tier||'?'} <div class="lin" style="background:linear-gradient(90deg,${cc}44,transparent)"></div></div>
    <div class="fila"><span class="fk">Tipo</span><span class="fv">${f.missionType||'‚Äî'}</span></div>
    <div class="fila"><span class="fk">Nodo</span><span class="fv az">${f.node||'‚Äî'}</span></div>
    <div class="fila"><span class="fk">Enemigo</span><span class="fv">${f.enemy||'‚Äî'}</span></div>
    ${f.isHard?`<div class="fila"><span class="fk">Modo</span><span class="fv rj">ACERO</span></div>`:''}
    <div class="fila"><span class="fk">Expira en</span>${ctr(f.expiry)}</div>
  </div>`;}).join('')}</div>`;
  anim(cont);
}

function renderSyndicatos(data) {
  const cont=c('syndicatos');
  if(!data?.length){cont.innerHTML='<p class="no-data">Sin datos de syndicatos.</p>';return;}
  cont.innerHTML=`<div class="grid g2">${data.map(s=>`<div class="tarjeta">
    <div class="ttitulo">${s.syndicate||'Syndicato'} <div class="lin"></div></div>
    <div style="margin-bottom:8px">${chips(s.jobs?s.jobs.map(j=>j.type):(s.nodes||[]))}</div>
    <div class="fila"><span class="fk">Expira en</span>${ctr(s.expiry)}</div>
  </div>`).join('')}</div>`;
  anim(cont);
}

function renderBaro(b) {
  const cont=c('baro');
  cont.innerHTML=`<div class="grid g2" style="margin-bottom:18px"><div class="tarjeta">
    <div class="ttitulo">INFORMACI√ìN GENERAL <div class="lin"></div></div>
    <div class="fila"><span class="fk">Estado</span><span class="fv">${etOk(b.active)}</span></div>
    <div class="fila"><span class="fk">Ubicaci√≥n</span><span class="fv az">${b.location||'‚Äî'}</span></div>
    <div class="fila"><span class="fk">${b.active?'Desaparece en':'Llega en'}</span>${ctr(b.active?b.expiry:b.activation)}</div>
    ${!b.active?`<div class="fila"><span class="fk">Fecha llegada</span><span class="fv">${ff(b.activation)}</span></div>`:''}
  </div></div>
  ${b.active&&b.inventory?.length
    ?`<div class="sec-header"><h2>INVENTARIO (${b.inventory.length} √çTEMS)</h2><div class="sep"></div></div>
      <div class="tbl-wrap"><table>
        <thead><tr><th>√çtem</th><th>Ducados</th><th>Cr√©ditos</th></tr></thead>
        <tbody>${b.inventory.map(i=>`<tr><td class="b">${i.item}</td><td style="color:var(--dorado);font-weight:700">${i.ducats} üü°</td><td style="color:var(--azul)">${(i.credits||0).toLocaleString()}</td></tr>`).join('')}</tbody>
      </table></div>`
    :'<p class="no-data">Baro no est√° presente actualmente.</p>'}`;
  anim(cont);
}

function renderArbitraje(a) {
  const cont=c('arbitraje');
  if(!a?.node){cont.innerHTML='<p class="no-data">Sin datos de arbitraje.</p>';return;}
  cont.innerHTML=`<div class="grid g2"><div class="tarjeta">
    <div class="ttitulo">MISI√ìN DE ARBITRAJE <div class="lin"></div></div>
    <div class="fila"><span class="fk">Nodo</span><span class="fv az">${a.node}</span></div>
    <div class="fila"><span class="fk">Tipo</span><span class="fv">${a.type||'‚Äî'}</span></div>
    <div class="fila"><span class="fk">Enemigo</span><span class="fv">${a.enemy||'‚Äî'}</span></div>
    ${a.archwing?`<div class="fila"><span class="fk">Archwing</span><span class="fv vd">S√ç</span></div>`:''}
    <div class="fila"><span class="fk">Expira en</span>${ctr(a.expiry)}</div>
  </div></div>`;
  anim(cont);
}

async function cargarCiclos(forzar=false) {
  if(!forzar&&cache.ciclos){renderCiclos(cache.ciclos);return;}
  c('ciclos').innerHTML=spin();
  try {
    const [cetus,vallis,cambion,zariman]=await Promise.all([
      apiFetch(`/${plat}/cetusCycle`),apiFetch(`/${plat}/vallisCycle`),
      apiFetch(`/${plat}/cambionCycle`),apiFetch(`/${plat}/zarimanCycle`),
    ]);
    cache.ciclos={cetus,vallis,cambion,zariman}; renderCiclos(cache.ciclos);
  } catch(e){c('ciclos').innerHTML=errHTML('ciclos',e.message);}
}

function renderCiclos(d) {
  const cont=c('ciclos');
  const ciclos=[
    {nom:'CETUS / EIDOLON',ico:d.cetus.isDay?'‚òÄÔ∏è':'üåô',est:d.cetus.isDay?'FASE DIURNA':'FASE NOCTURNA',cls:d.cetus.isDay?'c-dia':'c-noche',exp:d.cetus.expiry},
    {nom:'ORB VALLIS / FORTUNA',ico:d.vallis.isWarm?'üî•':'‚ùÑÔ∏è',est:d.vallis.isWarm?'C√ÅLIDO':'FR√çO',cls:d.vallis.isWarm?'c-calido':'c-frio',exp:d.vallis.expiry},
    {nom:'CORAZ√ìN DE DEIMOS',ico:'üß¨',est:(d.cambion.active||d.cambion.state||'‚Äî').toUpperCase(),cls:'c-dia',exp:d.cambion.expiry},
    {nom:'ZARIMAN TEN ZERO',ico:d.zariman.state==='grineer'?'üî¥':'üîµ',est:(d.zariman.state||'‚Äî').toUpperCase(),cls:'c-noche',exp:d.zariman.expiry},
  ];
  cont.innerHTML=`<div class="grid g2">${ciclos.map(cc=>`<div class="tarjeta">
    <div class="ttitulo">${cc.nom} <div class="lin"></div></div>
    <div class="ciclo-wrap"><span class="ciclo-ico">${cc.ico}</span><span class="ciclo-nombre ${cc.cls}">${cc.est}</span></div>
    <div class="fila"><span class="fk">Tiempo restante</span>${ctr(cc.exp)}</div>
  </div>`).join('')}</div>`;
  anim(cont);
}

function renderConstruccion(data) {
  const cont=c('construccion'); const items=Object.entries(data).filter(([k])=>k!=='id');
  if(!items.length){cont.innerHTML='<p class="no-data">Sin datos.</p>';return;}
  cont.innerHTML=`<div class="grid g2">${items.map(([key,val])=>{const p=parseFloat(val)||0;return`<div class="tarjeta">
    <div class="ttitulo">${key.toUpperCase()} <div class="lin"></div></div>
    <div class="fila"><span class="fk">Progreso</span><span class="fv do">${p.toFixed(2)}%</span></div>
    <div class="barra-w"><div class="barra b-do" style="width:${Math.min(p,100)}%"></div></div>
  </div>`;}).join('')}</div>`;
  anim(cont);
}

function renderMejoras(data) {
  const cont=c('mejoras');
  if(!data?.length){cont.innerHTML='<p class="no-data">No hay mejoras globales activas.</p>';return;}
  cont.innerHTML=`<div class="grid g2">${data.map(o=>`<div class="tarjeta">
    <div class="ttitulo">${o.upgrade||'Mejora Global'} <div class="lin"></div></div>
    <div class="fila"><span class="fk">Operaci√≥n</span><span class="fv az">${o.operation||'‚Äî'}</span></div>
    <div class="fila"><span class="fk">Valor</span><span class="fv do">${o.operationSymbol||''}${o.value||'‚Äî'}</span></div>
    ${o.desc?`<div class="fila"><span class="fk">Descripci√≥n</span><span class="fv">${o.desc}</span></div>`:''}
    <div class="fila"><span class="fk">Expira en</span>${ctr(o.expiry)}</div>
  </div>`).join('')}</div>`;
  anim(cont);
}

function renderNoticias(data) {
  const cont=c('noticias');
  if(!data?.length){cont.innerHTML='<p class="no-data">Sin noticias.</p>';return;}
  cont.innerHTML=`<div class="grid g2">${data.slice(0,20).map(n=>`<div class="tarjeta">
    <div class="ttitulo">${ff(n.date)} <div class="lin"></div></div>
    ${n.imageLink?`<img src="${n.imageLink}" alt="" style="width:100%;height:108px;object-fit:cover;margin-bottom:10px;border:1px solid var(--borde)">` :''}
    <div style="color:var(--blanco);font-size:.92rem;margin-bottom:8px;font-weight:600">${n.message||n.translations?.es||'‚Äî'}</div>
    ${n.link?`<a href="${n.link}" target="_blank" style="color:var(--azul);font-size:.73rem;letter-spacing:.1em;font-weight:700;text-decoration:none">VER NOTICIA ‚Üí</a>`:''}
  </div>`).join('')}</div>`;
  anim(cont);
}

function renderEventos(data) {
  const cont=c('eventos');
  if(!data?.length){cont.innerHTML='<p class="no-data">No hay eventos activos.</p>';return;}
  cont.innerHTML=`<div class="grid g2">${data.map(e=>{const p=parseFloat(e.health??e.completion??NaN);return`<div class="tarjeta">
    <div class="ttitulo">${e.description||'Evento'} <div class="lin"></div></div>
    ${e.tooltip?`<div style="color:var(--texto2);font-size:.83rem;margin-bottom:8px">${e.tooltip}</div>`:''}
    ${!isNaN(p)?`<div class="fila"><span class="fk">Progreso</span><span class="fv vd">${p.toFixed(1)}%</span></div><div class="barra-w"><div class="barra b-vd" style="width:${Math.min(p,100)}%"></div></div>`:''}
    ${e.node?`<div class="fila"><span class="fk">Nodo</span><span class="fv az">${e.node}</span></div>`:''}
    <div class="fila"><span class="fk">Expira en</span>${ctr(e.expiry)}</div>
    ${e.rewards?.length?`<div style="margin-top:8px">${chips(e.rewards.map(r=>r.itemString||r.asString))}</div>`:''}
  </div>`;}).join('')}</div>`;
  anim(cont);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// B√öSQUEDA DE √çTEMS Y RIVENS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function buscarItem() {
  const q=document.getElementById('inp-item').value.trim(); if(!q)return;
  const cont=c('items'); cont.innerHTML=spin();
  try {
    const data=await apiFetch(`/items/search/${encodeURIComponent(q)}`);
    if(!data?.length){cont.innerHTML='<p class="no-data">No se encontraron √≠tems.</p>';return;}
    cont.innerHTML=`<div class="grid g2">${data.slice(0,24).map(item=>`<div class="tarjeta">
      <div style="display:flex;gap:12px;align-items:flex-start">
        ${item.imageName?`<img src="https://cdn.warframestat.us/img/${item.imageName}" alt="" style="width:54px;height:54px;object-fit:contain;background:rgba(0,0,0,.3);border:1px solid var(--borde);padding:4px;flex-shrink:0" onerror="this.style.display='none'">`:''}
        <div style="flex:1">
          <div style="font-weight:700;color:var(--blanco);font-size:.95rem;margin-bottom:4px">${item.name}</div>
          <div style="margin-bottom:5px">${item.category?`<span class="etiq et-az">${item.category}</span>`:''} ${item.type?`<span class="etiq et-do">${item.type}</span>`:''}</div>
          ${item.description?`<div style="font-size:.8rem;color:var(--texto2);line-height:1.5">${item.description.slice(0,110)}${item.description.length>110?'‚Ä¶':''}</div>`:''}
        </div>
      </div>
      ${item.masteryReq?`<div class="fila" style="margin-top:8px"><span class="fk">Rango de Maestr√≠a</span><span class="fv do">MR ${item.masteryReq}</span></div>`:''}
      ${item.wikiaUrl?`<a href="${item.wikiaUrl}" target="_blank" style="display:block;margin-top:8px;color:var(--azul);font-size:.73rem;letter-spacing:.1em;font-weight:700;text-decoration:none">VER EN WIKI ‚Üí</a>`:''}
    </div>`).join('')}</div>`;
    anim(cont);
  } catch(e){cont.innerHTML=errHTML('items',e.message);}
}

async function buscarRiven() {
  const q=document.getElementById('inp-riven').value.trim(); if(!q)return;
  const cont=c('rivenes'); cont.innerHTML=spin();
  try {
    const data=await apiFetch(`/${plat}/rivens/search/${encodeURIComponent(q)}`);
    const entries=Object.entries(data||{});
    if(!entries.length){cont.innerHTML='<p class="no-data">Sin datos de riven para ese arma.</p>';return;}
    cont.innerHTML=`<div class="grid g2">${entries.map(([nom,s])=>`<div class="tarjeta">
      <div class="ttitulo" style="color:var(--morado)">üí† ${nom} <div class="lin" style="background:linear-gradient(90deg,rgba(170,68,255,.4),transparent)"></div></div>
      ${s.rerolled?.median!=null?`<div class="fila"><span class="fk">Con Re-roll (mediana)</span><span class="fv mo">${s.rerolled.median.toFixed(1)} pl</span></div>`:''}
      ${s.unrolled?.median!=null?`<div class="fila"><span class="fk">Sin Re-roll (mediana)</span><span class="fv az">${s.unrolled.median.toFixed(1)} pl</span></div>`:''}
      ${s.rerolled?.avg!=null?`<div class="fila"><span class="fk">Media con Re-roll</span><span class="fv">${s.rerolled.avg.toFixed(1)} pl</span></div>`:''}
      ${s.compatibility!=null?`<div class="fila"><span class="fk">Compatibilidad</span><span class="fv vd">${(s.compatibility*100).toFixed(1)}%</span></div>`:''}
      ${s.median!=null?`<div class="fila"><span class="fk">Precio mediano</span><span class="fv do">${s.median.toFixed(1)} pl</span></div>`:''}
    </div>`).join('')}</div>`;
    anim(cont);
  } catch(e){cont.innerHTML=errHTML('rivenes',e.message);}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INICIO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.addEventListener('DOMContentLoaded', () => {
  cargar('estado');
  setInterval(() => {
    const id=document.querySelector('.seccion.activa').id.replace('sec-','');
    if(!['items','rivenes'].includes(id)){delete cache[id];cargar(id);}
    upTS();
  }, 5*60*1000);
});
</script>
</body>
</html>
